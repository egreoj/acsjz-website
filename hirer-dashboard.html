<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Beehire — Hirer Dashboard</title>

  <!-- Corporate font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#FFC107;          /* honey gold */
      --ink:#0E2A32;            /* deep navy */
      --muted:#6B7B84;
      --bg:#F6F9FC;
      --card:#ffffff;
      --line:#E6EDF2;
      --line-strong:#D7E1EA;
      --focus:#2C7BE5;
      --ok:#16a34a; --warn:#d97706; --bad:#dc2626;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,#fff 0%, var(--bg) 70%); color:var(--ink);
    }

    /* Header */
    header{
      position:sticky; top:0; z-index:40;
      background:var(--card); border-bottom:1px solid var(--line);
      box-shadow:0 2px 10px rgba(14,42,50,.04);
    }
    .nav{
      max-width:1600px; margin:0 auto; padding:14px 20px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{display:flex; align-items:center; gap:12px; text-decoration:none}
    .brand-logo{width:42px; height:42px; object-fit:contain; filter:drop-shadow(0 2px 8px rgba(0,0,0,.06))}
    .brand-title{display:flex; flex-direction:column; line-height:1.1}
    .brand-title .name{font-weight:800; font-size:1.12rem; color:var(--ink)}
    .brand-title .tag{font-size:.8rem; color:var(--muted); font-weight:700; letter-spacing:.3px}

    .top-tools{display:flex; align-items:center; gap:10px}
    .badge{padding:6px 10px; border:1px solid var(--line-strong); border-radius:999px; color:var(--ink); font-weight:800; font-size:.8rem; background:#fff}

    /* Layout */
    .dashboard{
      display:grid; grid-template-columns:320px 1fr; gap:24px;
      max-width:1600px; margin:24px auto; padding:0 20px;
    }
    @media (max-width: 1100px){ .dashboard{ grid-template-columns:1fr } }

    /* Sidebar */
    .sidebar{
      background:var(--card); border:1px solid var(--line); border-radius:16px;
      padding:18px; height:fit-content; box-shadow:0 10px 24px rgba(14,42,50,.06);
      position:sticky; top:86px;
    }
    .sidebar h3{
      margin:0 0 10px; font-size:1.05rem; color:var(--ink);
      border-bottom:1px dashed var(--line-strong); padding-bottom:8px;
    }
    .filter-group{margin:14px 0}
    .filter-group label{font-weight:800; display:block; margin-bottom:6px; font-size:.92rem; color:var(--ink)}
    .filter-group input,.filter-group select{
      width:100%; padding:11px 12px; border:1px solid var(--line-strong); border-radius:12px; font-size:.95rem; background:#fff; color:var(--ink);
      transition:border-color .15s, box-shadow .15s, background .15s;
    }
    .filter-group input:focus, .filter-group select:focus{
      outline:none; border-color:var(--focus); box-shadow:0 0 0 3px rgba(44,123,229,.15)
    }
    .category-buttons{display:flex; flex-wrap:wrap; gap:8px}
    .category-buttons button{
      padding:8px 12px; border:1px solid var(--line-strong); border-radius:999px; cursor:pointer; font-size:.88rem; background:#fff; color:var(--ink); font-weight:700;
      transition:background .15s, box-shadow .15s, border-color .15s;
    }
    .category-buttons button:hover{ background:#FAFCFF; box-shadow:0 6px 16px rgba(14,42,50,.06) }
    .category-buttons button.active{ background:var(--brand); border-color:#e6c200 }

    /* Main list */
    .worker-list{
      display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:18px;
      align-content:start;
    }
    .muted{color:var(--muted); font-size:.95rem}

    .worker-card{
      background:var(--card); border:1px solid var(--line); border-radius:16px; padding:18px; text-align:center;
      position:relative; box-shadow:0 10px 24px rgba(14,42,50,.06); transition:transform .15s ease, box-shadow .15s ease;
      display:flex; flex-direction:column; gap:8px; min-height:260px;
    }
    .worker-card:hover{ transform:translateY(-3px); box-shadow:0 14px 28px rgba(14,42,50,.1) }
    .worker-card img{ width:92px; height:92px; border-radius:50%; border:3px solid var(--brand); object-fit:cover; margin:0 auto 6px; background:#fff }
    .status-dot{width:14px; height:14px; background:var(--ok); border:2px solid #fff; border-radius:50%; position:absolute; top:16px; right:16px}

    .worker-card h3{margin:6px 0 0; font-size:1.05rem}
    .subline{margin:0; font-size:.92rem; color:var(--muted)}
    .skill-chip{
      display:inline-block; margin-top:6px; padding:4px 10px; border-radius:999px;
      background:#FFF6D6; border:1px solid #F3D66A; font-weight:800; font-size:.78rem; color:#7A5B00
    }

    .chips{display:flex; justify-content:center; gap:6px; flex-wrap:wrap}
    .chip{padding:4px 10px; border-radius:12px; font-size:.78rem; color:#fff; font-weight:800}
    .chip.v{background:#16a34a}   /* Verified */
    .chip.p{background:#d97706}   /* Pending Review */
    .chip.u{background:#9ca3af}   /* Not Verified */
    .chip.r{background:#dc2626}   /* Rejected */

    .rating{color:#ffb400; font-size:1rem; margin-top:2px}

    .view-btn{
      margin-top:auto;
      background:var(--brand); border:none; padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer;
      transition:filter .15s, box-shadow .15s, transform .06s;
      box-shadow:0 8px 20px rgba(255,193,7,.28);
    }
    .view-btn:hover{ filter:brightness(.98); box-shadow:0 12px 26px rgba(255,193,7,.38) }
    .view-btn:active{ transform:translateY(1px) }

    /* Focus ring for buttons/links */
    button:focus, a:focus{ outline:none; box-shadow:0 0 0 3px rgba(44,123,229,.2) }

    /* Empty / loading skeletons */
    .skeleton{
      background:linear-gradient(90deg,#f0f3f7 25%,#f7f9fc 37%,#f0f3f7 63%); background-size:400% 100%;
      animation:shimmer 1.4s ease-in-out infinite; border-radius:12px
    }
    @keyframes shimmer{ 0%{background-position:100% 0} 100%{background-position:0 0} }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="nav">
      <a class="brand" href="#">
        <img class="brand-logo" src="BeeHire Logo.png" alt="Beehire logo">
        <span class="brand-title">
          <span class="name">Beehire CONNECT</span>
          <span class="tag">Hirer Dashboard</span>
        </span>
      </a>
      <div class="top-tools">
        <span class="badge">Signed in</span>
      </div>
    </div>
  </header>

  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar" aria-label="Filters">
      <h3>Filters</h3>

      <div class="filter-group">
        <label for="searchSkill">Search Skill</label>
        <input type="text" id="searchSkill" placeholder="e.g., Electrician" autocomplete="off" />
      </div>

      <div class="filter-group">
        <label for="filterVerified">Verification</label>
        <select id="filterVerified">
          <option value="all">All Workers</option>
          <option value="verified">Verified Only</option>
          <option value="unverified">Unverified Only</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filterLocation">Location</label>
        <select id="filterLocation">
          <option value="all">All</option>
          <option value="iloilo">Iloilo City</option>
          <option value="cebu">Cebu City</option>
          <option value="manila">Manila</option>
          <option value="bacolod">Bacolod</option>
          <option value="davao">Davao</option>
          <option value="cdo">Cagayan de Oro</option>
        </select>
      </div>

      <div class="filter-group">
        <label><input type="checkbox" id="filterAvailable"> Available Now</label>
      </div>

      <div class="filter-group category-buttons">
        <label>Categories</label>
        <button onclick="setCategory('Electrician')">Electrician</button>
        <button onclick="setCategory('Plumber')">Plumber</button>
        <button onclick="setCategory('Tutor')">Tutor</button>
        <button onclick="setCategory('Mechanic')">Mechanic</button>
        <button onclick="setCategory('Carpenter')">Carpenter</button>
        <button onclick="setCategory('Driver')">Driver</button>
        <button onclick="setCategory('Cook')">Cook</button>
        <button onclick="setCategory('IT Support')">IT Support</button>
      </div>

      <div class="filter-group">
        <label for="filterRate">Rate Range</label>
        <select id="filterRate">
          <option value="all">Any</option>
          <option value="low">₱100–₱300</option>
          <option value="mid">₱301–₱500</option>
          <option value="high">₱501+</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filterExperience">Experience</label>
        <select id="filterExperience">
          <option value="all">Any</option>
          <option value="0-1">0–1 yr</option>
          <option value="2-5">2–5 yrs</option>
          <option value="5+">5+ yrs</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filterRating">Rating</label>
        <select id="filterRating">
          <option value="all">Any</option>
          <option value="4">4★ & above</option>
          <option value="3">3★ & above</option>
        </select>
      </div>
    </aside>

    <!-- Worker Cards -->
    <section class="worker-list" id="workerList" aria-live="polite">
      <p class="muted" id="loadingState">Loading workers…</p>
    </section>
  </div>

  <!-- Firebase + App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCkkVvflDza_lmFmUmsgUQv6iOiMW3y9bc",
        authDomain: "myapp-96865.firebaseapp.com",
        databaseURL: "https://myapp-96865-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "myapp-96865",
        // If Storage misbehaves, try: "myapp-96865.appspot.com"
        storageBucket: "myapp-96865.firebasestorage.app",
        messagingSenderId: "217431866794",
        appId: "1:217431866794:web:965d02cc01d12ae555ffd3",
        measurementId: "G-1T4M9PE1GD"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const workerList = document.getElementById("workerList");
    const loadingState = document.getElementById("loadingState");

    // Filters
    const searchSkill = document.getElementById("searchSkill");
    const filterVerified = document.getElementById("filterVerified");
    const filterLocation = document.getElementById("filterLocation");
    const filterRate = document.getElementById("filterRate");
    const filterExperience = document.getElementById("filterExperience");
    const filterRating = document.getElementById("filterRating");
    const filterAvailable = document.getElementById("filterAvailable");

    // Helpers
    const toHttps = (u)=>!u ? "" : (u.startsWith("http://") ? u.replace("http://","https://") : u);
    const rateNum = (v)=>{
      if (v === null || v === undefined) return null;
      if (typeof v === "number") return v;
      const m = String(v).replace(/[^\d.]/g,"");
      return m ? parseFloat(m) : null;
    };
    const titleCase = (s)=> s ? s.charAt(0).toUpperCase() + s.slice(1) : "";

    function computeVerificationStatus(data){
      const docsCount = Array.isArray(data?.documents) ? data.documents.filter(x=>x && x.url).length : 0;
      const raw = (data?.verificationStatus || "").toString().trim().toLowerCase();

      if (raw){
        if (raw === "verified" || raw === "approved") return "Verified";
        if (raw === "pending" || raw === "in review" || raw === "review" || raw === "under review") return "Pending Review";
        if (raw === "rejected" || raw === "declined") return "Rejected";
        if (raw === "unverified") return "Not Verified";
      }
      if (data?.verified === true) return "Verified";
      if (docsCount > 0) return "Pending Review";
      return "Not Verified";
    }

    function statusChip(status){
      const map = { "Verified":"v", "Pending Review":"p", "Not Verified":"u", "Rejected":"r" };
      const cls = map[status] || "u";
      return `<span class="chip ${cls}">${status}</span>`;
    }

    let ALL_WORKERS = [];

    function renderStars(r){
      if (r == null || isNaN(r)) return "☆☆☆☆☆";
      const filled = Math.round(Math.max(0, Math.min(5, r)));
      return "⭐".repeat(filled) + "☆".repeat(5 - filled);
    }

    function normalizeWorker(uid, d){
      const name = d.fullName || d.name || d.username || "Worker";
      const skill = d.skillCategory || (Array.isArray(d.skills) && d.skills.length ? d.skills[0] : "Skill");
      const locationLabel = d.location || "Unknown";
      const lower = locationLabel.toLowerCase();
      const locationKey = lower.includes("iloilo") ? "iloilo"
                        : lower.includes("cebu") ? "cebu"
                        : lower.includes("manila") ? "manila"
                        : lower.includes("bacolod") ? "bacolod"
                        : lower.includes("davao") ? "davao"
                        : lower.includes("cagayan") ? "cdo"
                        : "other";

      const rate = rateNum(d.pricing);
      const exp = typeof d.experience === "number" ? d.experience : null;
      const rating = typeof d.rating === "number" ? d.rating
                     : (typeof d.ratingAvg === "number" ? d.ratingAvg
                     : (typeof d.ratingAverage === "number" ? d.ratingAverage : null));
      const photo = toHttps(d.profileImageUrl || d.photoUrl) || "images/profile_placeholder.png";
      const available = d.online === true || String(d.availability || "").toLowerCase().includes("available");

      const status = computeVerificationStatus(d);

      return {
        uid,
        name,
        photo,
        skill,
        locationLabel: titleCase(locationLabel),
        locationKey,
        rate,
        exp,
        rating,
        status,  // "Verified" | "Pending Review" | "Not Verified" | "Rejected"
        available
      };
    }

    function makeCard(w){
      const card = document.createElement("div");
      card.className = "worker-card";
      card.dataset.skill = w.skill || "";
      card.dataset.status = w.status;
      card.dataset.location = (w.locationKey || "all");
      card.dataset.rate = w.rate ?? "";
      card.dataset.exp = w.exp ?? "";
      card.dataset.rating = w.rating ?? "";
      card.dataset.available = String(w.available);

      card.innerHTML = `
        ${w.available ? '<div class="status-dot" title="Available now"></div>' : ''}
        <img src="${w.photo}" alt="${w.name}">
        <span class="skill-chip">${w.skill}</span>
        <h3>${w.name}</h3>
        <p class="subline">${w.locationLabel}</p>
        <p class="subline">Rate: ${w.rate != null ? `₱${w.rate}/hr` : '—'}</p>
        <div class="rating" aria-label="Rating">${renderStars(w.rating)}</div>
        <div class="chips">${statusChip(w.status)}</div>
        <button class="view-btn" data-uid="${w.uid}" aria-label="View ${w.name} profile">View Profile</button>
      `;
      return card;
    }

    function renderList(items){
      workerList.innerHTML = "";
      if (!items.length){
        workerList.innerHTML = `<p class="muted">No workers match your filters.</p>`;
        return;
      }
      const frag = document.createDocumentFragment();
      items.forEach(w => frag.appendChild(makeCard(w)));
      workerList.appendChild(frag);

      // Bind "View Profile"
      workerList.querySelectorAll(".view-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const uid = btn.getAttribute("data-uid");
          if (uid) window.location.href = `Profile_hirer_view.html?uid=${encodeURIComponent(uid)}`;
        });
      });
    }

    function applyFilters(){
      const skillValue = searchSkill.value.trim().toLowerCase();
      const verifiedValue = filterVerified.value;
      const locationValue = filterLocation.value;
      const rateValue = filterRate.value;
      const expValue = filterExperience.value;
      const ratingValue = filterRating.value;
      const availableValue = filterAvailable.checked;

      const filtered = ALL_WORKERS.filter(w=>{
        if (skillValue && !String(w.skill).toLowerCase().includes(skillValue)) return false;

        if (verifiedValue !== "all"){
          if (verifiedValue === "verified" && w.status !== "Verified") return false;
          if (verifiedValue === "unverified" && w.status === "Verified") return false;
        }

        if (locationValue !== "all" && w.locationKey !== locationValue) return false;

        if (rateValue === "low"  && !(w.rate != null && w.rate <= 300)) return false;
        if (rateValue === "mid"  && !(w.rate != null && w.rate >= 301 && w.rate <= 500)) return false;
        if (rateValue === "high" && !(w.rate != null && w.rate >= 501)) return false;

        if (expValue === "0-1" && !(w.exp != null && w.exp <= 1)) return false;
        if (expValue === "2-5" && !(w.exp != null && w.exp >= 2 && w.exp <= 5)) return false;
        if (expValue === "5+"  && !(w.exp != null && w.exp >= 5)) return false;

        if (ratingValue !== "all" && !(w.rating != null && w.rating >= parseFloat(ratingValue))) return false;

        if (availableValue && !w.available) return false;

        return true;
      });

      renderList(filtered);
    }

    // Debounce for search
    function debounce(fn, ms=200){
      let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); };
    }

    // Category quick set
    window.setCategory = function(cat){
      document.querySelectorAll('.category-buttons button').forEach(b=> b.classList.toggle('active', b.textContent === cat));
      searchSkill.value = cat;
      applyFilters();
    };

    // Listeners
    searchSkill.addEventListener("input", debounce(applyFilters, 250));
    filterVerified.addEventListener("change", applyFilters);
    filterLocation.addEventListener("change", applyFilters);
    filterRate.addEventListener("change", applyFilters);
    filterExperience.addEventListener("change", applyFilters);
    filterRating.addEventListener("change", applyFilters);
    filterAvailable.addEventListener("change", applyFilters);

    // Fetch workers
    (async function init(){
      try{
        const snap = await getDocs(collection(db, "workers"));
        ALL_WORKERS = snap.docs.map(d => normalizeWorker(d.id, d.data()));
        loadingState?.remove();
        renderList(ALL_WORKERS);
      }catch(err){
        console.error("Failed to load workers:", err);
        if (loadingState) loadingState.textContent = "Failed to load workers.";
      }
    })();
  </script>
</body>
</html>
